{% extends "base.html" %}

{% block title %}
RedWine
{% endblock title %}
{% load filters %}

{% block styles %}
{{ block.super }}
<link href="{{ STATIC_URL }}css/redwine.css" rel="stylesheet">
{% endblock %}

{% block content %}


<section id="redWine">
<div class="container">
<div id="nyan" class="nyan">{{committees}} </div>
{%for kom, users in committees.items %}
<div class="panel panel-default" id="accordion">
  <div class="panel-heading">Vinstraffer: {{kom}}</div>
  <table class="table">
    <tr class="center">
        <td class="left col-md-6"><strong>Navn</strong></td>
        <td class="left"><strong>Antall</strong></td>
        <td><strong>Sist straffet</strong></td>
        <td></td>
    </tr>
    {%for member, tot in users %}
    <tr data-toggle="collapse" data-target="#{{forloop.counter}}" data-parent="#accordion" class="accordion-toggle center clickable">
        <td class="nameCell left col-md-6">{{ member.get_full_name }}</td>
        <td title="{{ tot }} vinpenalties" class="nameCell left">
            {% for wine in tot|get_range %}
            <img src="/static/img/wine.png" alt="Vin" class="wine">
            {% endfor %}
        </td>
      <td class="nameCell">{{ member.penalties.latest.date | date:"d M Y H:i" }}</td>
        <td><a href="#"><span class="glyphicon glyphicon-chevron-down"></span></a></td>
    </tr>
    <tr>
        <td colspan="4" class="hiddenRow">
          <div class="accordian-body collapse elementInfo {% ifequal forloop.counter editedUser %}in{% endifequal %}" id="{{forloop.counter}}">

                <div class="row noMargin">
                  <div class="newCol">
                    <form class="form-inline addNew" role="form" action="." method="post">
                    {% csrf_token %}
                     {{ form.non_field_errors }}
                      <div class="form-group">
                        <div class="col-xs-10">
                        <label class="sr-only" for="exampleInputEmail2">Ny Vinstraff</label>
                        {{ form.reason.errors }}
                      <input type="text" maxlength="100" class="form-control" id="id_reason" name="reason" placeholder="Begrunnelse pÃ¥ ny vinstraff">
                          </div>
                        <div class="addBox col-xs-1">
                          {{ form.amount.errors }}
                        <select id="select-control" class="form-control" id="amount" name="amount">
                        {% for num in "123456789"%}
                        <option{%ifequal num wineString %} nosel {% endifequal %}>{{ num }}</option>
                        {%endfor%}
                        </select>
                        <input id="id_to" name="to" type="hidden" value="{{ member.id }}">
<button type="submit" name="act" class="btn btn-success" title="Ny Vinstraff" value="add">
                      <span class="glyphicon glyphicon-plus"></span></button>
                        </div>
                      </div>

                     
                    </div>
                  </div>
                  {%for penalty in member.penalties.all %}
                  {% ifequal penalty.deleted showDeleted %}
                  <div class="row noMargin">
                  <hr>
                  <div class="col-md-6">
                    <blockquote>
                      <p class="breakword">{{ penalty.reason }}</p> 
                    <small>Gitt av <cite title="Source Title">{{ penalty.giver }}</cite></small>
                    </blockquote>
                  </div>

                  <div title="{{ penalty.amount }} vinpenalties." class="col-sm-2 nameCell left noLeftPadd">
                        {% for vin in penalty.amount|get_range %}
                    {%ifequal member.get_full_name 'Rikke Rye' %}
                        <img src="/static/img/cake.png" alt="Cake" class="cake">
                    {%else%}
                        <img src="/static/img/wine.png" alt="Vin" class="wine">
                    {%endifequal%}
                        {% endfor %}
                    </div>

                    <div title="Vinstraff gitt {{ penalty.date | date:'d M Y H:i' }}" class="col-sm-2 nameCell minCell">
                          {{penalty.date | date:"d M Y H:i"}}
                    </div>

                  <div class="col-sm-2">
                    <span class="rightFloat">
                      {%if penalty.deleted %}
                      <button type="submit" name="act" class="btn" title="Slettet straff" value="">
                      <span class="glyphicon glyphicon-ban-circle"></span> Slettet</button>
                      {% else %}
                      <button type="submit" name="act" class="btn btn-danger" title="Slett" value="delete {{ penalty.pk }}">
                      <span class="glyphicon glyphicon-ban-circle"></span> Slett</button>
                      {% endif %}
                    </span>
                  </div>
                  </div>
                  {% endifequal %}
                    {% endfor %}
                  <div class="row noMargin">
                    <hr>
                    <div class="moreCell">
                      
                      {%if showDeleted %}
                       <button type="submit" name="act" class="btn btn-warning" title="Vis Slettede Straffer" value="">
                       <span class="glyphicon glyphicon-eye-close"></span> Skjul Slettede</button>
                      {% else %}
                       <button type="submit" name="act" class="btn btn-warning" title="Vis Slettede Straffer" value="showhidden {{ member.user.id }}">
                       <span class="glyphicon glyphicon-trash"></span> Vis Slettede</button>
                      {% endif %}     
                     <button type="submit" name="act" class="btn permabutton" title="Annuler alle penalties" value="nuke {{ member.user.id }}">
                      <span class="glyphicon glyphicon-fire"></span> Slett Alle</button>
                    </div>
                  </div>
                  </form>
                </div> 
            </div>
                
        </td>
    </tr>
    {%endfor%}

</table>
</div>
{% endfor %}
{%if ownDelete %}
<script>
   $(document.getElementById("nyan")).toggleClass( "goNyan" ); 
</script>
{% endif %}
</div>
</section>
{% endblock content %}
