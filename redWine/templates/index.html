{% extends "base.html" %}

{% block title %}
RedWine
{% endblock title %}

{% load filters %}

{% block content %}
<!-- todo: sort by name/last given/total amount -->
<div class="panel panel-default" id="accordion">
  <div class="panel-heading">Vinstraffer</div>
  <table class="table">
    <tr class="center">
        <td class="left col-md-6"><strong>Navn</strong></td>
        <td class="left"><strong>Antall</strong></td>
        <td><strong>Sist straffet</strong></td>
        <td></td>
    </tr>

    {%for member in users %}
    {%ifequal member.komite 'dotKom' %}
    <tr data-toggle="collapse" data-target="#{{forloop.counter}}" data-parent="#accordion" class="accordion-toggle center clickable">
        <td class="nameCell left col-md-6">{{ member.user.get_full_name }}</td>
        <td title="{{ member.total }} vinstraffer" class="nameCell left">
            {% for vin in member.total|get_range %}
            <img src="/static/img/wine.png" alt="Vin" class="wine">
            {% endfor %}
        </td>
      <td class="nameCell">{{ member.straffer.latest.date | date:"d M Y H:i" }}</td>
        <td><a href="#"><span class="glyphicon glyphicon-chevron-down"></span></a></td>
    </tr>
    <tr>
        <td colspan="4" class="hiddenRow">
          <div class="accordian-body collapse elementInfo {% ifequal forloop.counter editedUser %}in{% endifequal %}" id="{{forloop.counter}}">

                <div class="row noMargin">
                  <div class="newCol">
                    <form class="form-inline addNew" role="form" action="." method="post">
                    {% csrf_token %}
                     {{ form.non_field_errors }}
                      <div class="form-group">
                        <div class="col-xs-10">
                        <label class="sr-only" for="exampleInputEmail2">Ny Vinstraff</label>
                        {{ form.reason.errors }}
                      <input type="text" maxlength="100" class="form-control" id="id_reason" name="reason" placeholder="Begrunnelse pÃ¥ ny vinstraff">
                          </div>
                        <div class="addBox col-xs-1">
                          {{ form.amount.errors }}
                        <select id="select-control" class="form-control" id="amount" name="amount">
                        {% for num in "123456789"%}
                        <option{%ifequal num wineString %} nosel {% endifequal %}>{{ num }}</option>
                        {%endfor%}
                        </select>
                        <input id="id_to" name="to" type="hidden" value="{{ member.user.id }}">
<button type="submit" name="act" class="btn btn-success" title="Ny Vinstraff" value="add">
                      <span class="glyphicon glyphicon-plus"></span></button>
                        </div>
                      </div>

                     
                    </div>
                  </div>
                  {%for straff in member.straffer.all %}
                  {% ifequal straff.deleted showDeleted %}
                  <div class="row noMargin">
                  <hr>
                  <div class="col-md-6">
                    <blockquote>
                      <p class="breakword">{{ straff.reason }}</p> 
                    <small>Gitt av <cite title="Source Title">{{ straff.giver }}</cite></small>
                    </blockquote>
                  </div>

                  <div title="{{ straff.amount }} vinstraffer." class="col-sm-2 nameCell left noLeftPadd">
                        {% for vin in straff.amount|get_range %}
                        <img src="/static/img/wine.png" alt="Vin" class="wine">
                        {% endfor %}
                    </div>

                    <div title="Vinstraff gitt {{ straff.date | date:'d M Y H:i' }}" class="col-sm-2 nameCell minCell">
                          {{straff.date | date:"d M Y H:i"}}
                    </div>

                  <div class="col-sm-2">
                    <span class="rightFloat">
                      {%if straff.deleted %}
                      <button type="submit" name="act" class="btn" title="Slettet straff" value="">
                      <span class="glyphicon glyphicon-ban-circle"></span> Slettet</button>
                      {% else %}
                      <button type="submit" name="act" class="btn btn-danger" title="Slett" value="delete {{ straff.pk }}">
                      <span class="glyphicon glyphicon-ban-circle"></span> Slett</button>
                      {% endif %}
                    </span>
                  </div>
                  </div>
                  {% endifequal %}
                    {% endfor %}
                  <div class="row noMargin">
                    <hr>
                    <div class="moreCell">
                      
                      {%if showDeleted %}
                       <button type="submit" name="act" class="btn btn-warning" title="Vis Slettede Straffer" value="">
                       <span class="glyphicon glyphicon-eye-close"></span> Skjul Slettede</button>
                      {% else %}
                       <button type="submit" name="act" class="btn btn-warning" title="Vis Slettede Straffer" value="showhidden {{ member.user.id }}">
                       <span class="glyphicon glyphicon-trash"></span> Vis Slettede</button>
                      {% endif %}     
                     <button type="submit" name="act" class="btn permabutton" title="Annuler alle straffer" value="nuke {{ member.user.id }}">
                      <span class="glyphicon glyphicon-fire"></span> Slett Alle</button>
                    </div>
                  </div>
                  </form>
                </div> 
            </div>
                
        </td>
    </tr>
    {% endifequal %}
    {%endfor%}

</table>
</div>
{% endblock content %}
